(this.webpackJsonpdttds04frontend=this.webpackJsonpdttds04frontend||[]).push([[4],{743:function(t,e,n){"use strict";n.r(e),n.d(e,"MapBoxMap",(function(){return y}));var a=n(17),i=n(12),o=n(744),c=n(386),d=n(673),l=n(708),u=n.n(l),r=n(0),s=n(742),f=n(67),b=n(106),j=n(72),v=n(84),p=n(2);u.a.workerClass=n(741).default;var y=function(){var t=Object(r.useContext)(b.a),e=t.mapviewMarker,n=t.mapviewTraffic,c=t.mapviewMissing,d=Object(r.useContext)(f.a).updatedVacancy,l=Object(r.useState)(),u=Object(i.a)(l,2),y=u[0],O=u[1],h=Object(r.useState)(),x=Object(i.a)(h,2),g=x[0],C=x[1],w=Object(r.useState)(),k=Object(i.a)(w,2),M=k[0],A=k[1],S=Object(r.useState)({latitude:22.384523,longitude:114.133201,zoom:10.5}),T=Object(i.a)(S,2),z=T[0],F=T[1];Object(r.useEffect)((function(){J()}),[]),Object(r.useEffect)((function(){d.data&&_(d.data)}),[d.data]);var J=function(){O(v.a.map((function(t){return{id:t.park_id,name:t.name_en,latitude:t.latitude,longitude:t.longitude}})))},_=function(t){var e=t.car_park.reduce((function(t,e){var n,a,i,o,c=null===(n=e.vehicle_type.find((function(t){return"P"===t.type})))||void 0===n||null===(a=n.service_category)||void 0===a?void 0:a.find((function(t){return"A"===t.vacancy_type}));return t[e.park_id]={vacancy:null!==(i=null===c||void 0===c?void 0:c.vacancy)&&void 0!==i?i:-1,lastupdate:null!==(o=null===c||void 0===c?void 0:c.lastupdate)&&void 0!==o?o:"-"},t}),{});A(e)},W=function(t){C(t)};return Object(p.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(p.jsxs)(s.c,Object(a.a)(Object(a.a)({borderRadius:25,width:"100%",height:"100%",mapStyle:n?"mapbox://styles/mapbox/navigation-night-v1":"mapbox://styles/mapbox/dark-v10",mapboxApiAccessToken:"pk.eyJ1IjoiYm9yZWFzaGUiLCJhIjoiY2txZ2MxdHBoMDJxcTJwcm85NTM0MWI1bCJ9.AHoFkmdAIq-SFTf7mGwzoA"},z),{},{onViewportChange:function(t){return F(t)},children:[y&&y.map((function(t){return Object(p.jsx)(s.a,{longitude:t.longitude,latitude:t.latitude,children:Object(p.jsx)(o.a,{onMouseEnter:function(){return W(t.id)},onMouseLeave:function(){return W(void 0)},style:{display:e&&(c||-1!==M[t.id].vacancy)?"initial":"none",width:36,height:36,color:Object(j.a)(Math.floor(M[t.id].vacancy/50*10))}})})})),g&&Object(p.jsx)(m,{closeTooltip:function(){return C(void 0)},marker:y.find((function(t){return t.id===g})),detail:M[g]})]}))})},m=function(t){var e=t.marker,n=t.detail,a=t.closeTooltip,o=Object(r.useState)(),l=Object(i.a)(o,2),u=l[0],f=l[1];return Object(r.useEffect)((function(){if(n.lastupdate){var t=Object(c.a)(n.lastupdate,"yyyy-MM-dd HH:mm:ss",new Date),e=Object(d.a)(new Date,t),a="(".concat(e," min").concat(1!==e?"s":""," ago)");f(a)}}),[]),Object(p.jsx)(s.b,{latitude:e.latitude,longitude:e.longitude,onClose:a,closeButton:!1,closeOnClick:!1,offsetLeft:17.5,children:Object(p.jsxs)("div",{style:{margin:10,color:"#2C292D",display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(p.jsx)("div",{style:{fontSize:20,fontWeight:"bold",fontFamily:"AdobeClean",width:175,margin:"0 auto"},children:e.name}),Object(p.jsx)("div",{style:{fontSize:12,fontWeight:"bold",color:"#939293",marginTop:10,fontFamily:"AdobeClean"},children:"LAST KNOWN VACANCY"}),Object(p.jsx)("div",{style:{color:Object(j.a)(Math.floor(n.vacancy/50*10)),fontSize:60,fontWeight:"bold",lineHeight:"60px",marginBottom:10,fontFamily:"AdobeClean"},children:-1!==n.vacancy?n.vacancy:"-"}),Object(p.jsxs)("div",{style:{fontSize:12,color:"#939293",fontFamily:"AdobeClean"},children:["Last Update: ","".concat(n.lastupdate," ").concat(null!==u&&void 0!==u?u:"")]})]})})};e.default=y}}]);
//# sourceMappingURL=4.b3bb2801.chunk.js.map