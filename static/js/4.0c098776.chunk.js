(this.webpackJsonpdttds04frontend=this.webpackJsonpdttds04frontend||[]).push([[4],{571:function(t,e,n){"use strict";n.r(e),n.d(e,"MapBoxMap",(function(){return O}));var a=n(12),i=n(13),o=n(568),c=n(570),l=n(572),d=n(531),r=n.n(d),u=n(0),s=n(566),f=n(135),v=n(96),b=n(564),j=n.n(b),p=j.a.scale(["red","green"]).colors(10).map((function(t){return j()(t).luminance(Math.min(Math.max(j()(t).luminance(),.3),.8)).hex()})),y=function(t){return t>9&&(t=9),p[t]},h=n(176),m=n(5);r.a.workerClass=n(565).default;var O=function(){var t=Object(u.useContext)(v.a),e=t.overviewMarker,n=t.overviewTraffic,c=t.overviewMissing,l=Object(u.useContext)(f.a).updatedVacancy,d=Object(u.useState)(),r=Object(i.a)(d,2),b=r[0],j=r[1],p=Object(u.useState)(),O=Object(i.a)(p,2),g=O[0],C=O[1],M=Object(u.useState)(),w=Object(i.a)(M,2),k=w[0],A=w[1],S=Object(u.useState)({latitude:22.384523,longitude:114.133201,zoom:10.5}),_=Object(i.a)(S,2),T=_[0],z=_[1];Object(u.useEffect)((function(){F()}),[]),Object(u.useEffect)((function(){l.data&&J(l.data)}),[l.data]);var F=function(){j(h.a.map((function(t){return{id:t.park_id,name:t.name_en,latitude:t.latitude,longitude:t.longitude}})))},J=function(t){var e=t.car_park.reduce((function(t,e){var n,a,i,o,c,l,d,r;return t[e.park_id]={vacancy:null!==(n=null===(a=e.vehicle_type.find((function(t){return"P"===t.type})))||void 0===a||null===(i=a.service_category)||void 0===i||null===(o=i.find((function(t){return"A"===t.vacancy_type})))||void 0===o?void 0:o.vacancy)&&void 0!==n?n:-1,lastupdate:null!==(c=null===(l=e.vehicle_type.find((function(t){return"P"===t.type})))||void 0===l||null===(d=l.service_category)||void 0===d||null===(r=d.find((function(t){return"A"===t.vacancy_type})))||void 0===r?void 0:r.lastupdate)&&void 0!==c?c:"-"},t}),{});A(e)},W=function(t){C(t)};return Object(m.jsx)("div",{style:{width:"100%",height:"100%"},children:Object(m.jsxs)(s.c,Object(a.a)(Object(a.a)({borderRadius:25,width:"100%",height:"100%",mapStyle:n?"mapbox://styles/mapbox/navigation-night-v1":"mapbox://styles/mapbox/dark-v10",mapboxApiAccessToken:"pk.eyJ1IjoiYm9yZWFzaGUiLCJhIjoiY2txZ2MxdHBoMDJxcTJwcm85NTM0MWI1bCJ9.AHoFkmdAIq-SFTf7mGwzoA"},T),{},{onViewportChange:function(t){return z(t)},children:[b&&b.map((function(t){return Object(m.jsx)(s.a,{longitude:t.longitude,latitude:t.latitude,children:Object(m.jsx)(o.a,{onMouseEnter:function(){return W(t.id)},onMouseLeave:function(){return W(void 0)},style:{display:e&&(c||-1!==k[t.id].vacancy)?"initial":"none",width:36,height:36,color:y(Math.floor(k[t.id].vacancy/50*10))}})})})),g&&Object(m.jsx)(x,{closeTooltip:function(){return C(void 0)},marker:b.find((function(t){return t.id===g})),detail:k[g]})]}))})},x=function(t){var e=t.marker,n=t.detail,a=t.closeTooltip,o=Object(u.useState)(),d=Object(i.a)(o,2),r=d[0],f=d[1];return Object(u.useEffect)((function(){if(n.lastupdate){var t=Object(c.a)(n.lastupdate,"yyyy-MM-dd HH:mm:ss",new Date),e=Object(l.a)(new Date,t),a="(".concat(e," min").concat(1!==e?"s":""," ago)");f(a)}}),[]),Object(m.jsx)(s.b,{latitude:e.latitude,longitude:e.longitude,onClose:a,closeButton:!1,closeOnClick:!1,offsetLeft:17.5,children:Object(m.jsxs)("div",{style:{margin:10,color:"#2C292D",display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(m.jsx)("div",{style:{fontSize:20,fontWeight:"bold",fontFamily:"AdobeClean",width:150,margin:"0 auto"},children:e.name}),Object(m.jsx)("div",{style:{fontSize:12,fontWeight:"bold",color:"#939293",marginTop:10,fontFamily:"AdobeClean"},children:"LAST KNOWN VACANCY"}),Object(m.jsx)("div",{style:{color:y(Math.floor(n.vacancy/50*10)),fontSize:60,fontWeight:"bold",lineHeight:"60px",marginBottom:10,fontFamily:"AdobeClean"},children:-1!==n.vacancy?n.vacancy:"-"}),Object(m.jsxs)("div",{style:{fontSize:12,color:"#939293",fontFamily:"AdobeClean"},children:["Last Update: ","".concat(n.lastupdate," ").concat(null!==r&&void 0!==r?r:"")]})]})})};e.default=O}}]);
//# sourceMappingURL=4.0c098776.chunk.js.map