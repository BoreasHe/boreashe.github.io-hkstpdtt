{"version":3,"sources":["helper/color.js","components/MapBoxMap.jsx"],"names":["interpolatedColors","chroma","scale","colors","map","c","luminance","Math","min","max","hex","getColorAt","num","mapboxgl","workerClass","require","default","MapBoxMap","useContext","NavBarContext","overviewMarker","overviewTraffic","overviewMissing","updatedVacancy","DataContext","useState","markerList","setMarkerList","selectedId","setSelectedId","paVacancy","setPaVacancy","latitude","longitude","zoom","viewport","setViewport","useEffect","initMarkerList","data","mapPaVacancy","basicInfo","carpark","id","park_id","name","name_en","aggregation","car_park","reduce","buffer","find","vt","type","sc","vacancy_type","vacancy","lastupdate","openPopUp","style","width","height","borderRadius","mapStyle","mapboxApiAccessToken","onViewportChange","nextViewport","marker","LocationOnTwoTone","onMouseEnter","onMouseLeave","undefined","display","color","floor","closeTooltip","detail","CarparkTooltip","props","timeDifference","setTimeDifference","updatedTime","parse","Date","diff","differenceInMinutes","diffString","onClose","closeButton","closeOnClick","offsetLeft","margin","flexDirection","justifyContent","fontSize","fontWeight","fontFamily","marginTop","lineHeight","marginBottom"],"mappings":"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","file":"static/js/4.0c098776.chunk.js","sourcesContent":["import chroma from \"chroma-js\";\r\n\r\nexport const interpolatedColors = chroma.scale([\"red\", \"green\"]).colors(10).map(c => chroma(c).luminance(Math.min(Math.max(chroma(c).luminance(), 0.3), 0.8)).hex());\r\n\r\nexport const getColorAt = (num) => {\r\n    if (num > 9)\r\n        num = 9;\r\n\r\n    return interpolatedColors[num];\r\n}","import { LocationOnTwoTone } from \"@material-ui/icons\";\r\nimport { differenceInMinutes, parse } from \"date-fns\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport { useContext, useEffect, useState } from \"react\";\r\nimport ReactMapGL, { Marker, Popup } from 'react-map-gl';\r\nimport { DataContext } from \"../context/DataContext\";\r\nimport { NavBarContext } from \"../context/NavBarContext\";\r\nimport { getColorAt } from \"./../helper/color\";\r\nimport { basicInfo } from \"./../res/basicInfo\";\r\n\r\nmapboxgl.workerClass = require(\"worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker\").default; // eslint-disable-line\r\n\r\nexport const MapBoxMap = () => {\r\n\r\n    const { overviewMarker, overviewTraffic, overviewMissing } = useContext(NavBarContext);\r\n    const { updatedVacancy } = useContext(DataContext);\r\n\r\n    const [markerList, setMarkerList] = useState();\r\n    const [selectedId, setSelectedId] = useState();\r\n\r\n    const [paVacancy, setPaVacancy] = useState();\r\n\r\n    const [viewport, setViewport] = useState({\r\n        latitude: 22.384523,\r\n        longitude: 114.133201,\r\n        zoom: 10.5\r\n    });\r\n\r\n    useEffect(() => {\r\n        initMarkerList();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (updatedVacancy.data)\r\n            mapPaVacancy(updatedVacancy.data);\r\n    }, [updatedVacancy.data])\r\n\r\n    const initMarkerList = () => {\r\n        setMarkerList(basicInfo.map(carpark => {\r\n            return {\r\n                id: carpark.park_id,\r\n                name: carpark.name_en,\r\n                latitude: carpark.latitude,\r\n                longitude: carpark.longitude\r\n            }\r\n        }))\r\n    }\r\n\r\n    const mapPaVacancy = (data) => {\r\n        const aggregation = data.car_park.reduce((buffer, carpark) => {\r\n            buffer[carpark.park_id] = {\r\n                \"vacancy\": carpark[\"vehicle_type\"].find(vt => vt.type === \"P\")?.[\"service_category\"]?.find(sc => sc.vacancy_type === \"A\")?.vacancy ?? -1,\r\n                \"lastupdate\": carpark[\"vehicle_type\"].find(vt => vt.type === \"P\")?.[\"service_category\"]?.find(sc => sc.vacancy_type === \"A\")?.lastupdate ?? \"-\"\r\n            }\r\n            return buffer;\r\n        }, {})\r\n\r\n        setPaVacancy(aggregation);\r\n    }\r\n\r\n    const openPopUp = (id) => {\r\n        setSelectedId(id);\r\n    }\r\n\r\n    return (\r\n        <div style={{ width: \"100%\", height: \"100%\" }}>\r\n            <ReactMapGL\r\n                borderRadius={25}\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                mapStyle={overviewTraffic ? \"mapbox://styles/mapbox/navigation-night-v1\" : \"mapbox://styles/mapbox/dark-v10\"}\r\n                mapboxApiAccessToken=\"pk.eyJ1IjoiYm9yZWFzaGUiLCJhIjoiY2txZ2MxdHBoMDJxcTJwcm85NTM0MWI1bCJ9.AHoFkmdAIq-SFTf7mGwzoA\"\r\n                {...viewport}\r\n                onViewportChange={nextViewport => setViewport(nextViewport)}\r\n            >\r\n                {\r\n                    markerList &&\r\n                    markerList.map(marker => (\r\n                        <Marker\r\n                            longitude={marker.longitude}\r\n                            latitude={marker.latitude}>\r\n                            <LocationOnTwoTone\r\n                                onMouseEnter={() => openPopUp(marker.id)}\r\n                                onMouseLeave={() => openPopUp(undefined)}\r\n                                style={{\r\n                                    display: overviewMarker\r\n                                        ? (\r\n                                            !overviewMissing && paVacancy[marker.id].vacancy === -1\r\n                                                ? \"none\"\r\n                                                : \"initial\"\r\n                                        )\r\n                                        : \"none\",\r\n                                    width: 36,\r\n                                    height: 36,\r\n                                    color: getColorAt(Math.floor(paVacancy[marker.id].vacancy / 50 * 10))\r\n                                }}\r\n                            />\r\n                        </Marker>\r\n                    ))\r\n                }\r\n\r\n                {\r\n                    selectedId &&\r\n                    <CarparkTooltip\r\n                        closeTooltip={() => setSelectedId(undefined)}\r\n                        marker={markerList.find(marker => marker.id === selectedId)}\r\n                        detail={paVacancy[selectedId]}\r\n                    />\r\n                }\r\n            </ReactMapGL>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst CarparkTooltip = (props) => {\r\n\r\n    const { marker, detail, closeTooltip } = props;\r\n\r\n    const [timeDifference, setTimeDifference] = useState()\r\n\r\n    useEffect(() => {\r\n        if (detail.lastupdate) {\r\n            const updatedTime = parse(detail.lastupdate, \"yyyy-MM-dd HH:mm:ss\", new Date());\r\n            const diff = differenceInMinutes(new Date(), updatedTime);\r\n            const diffString = `(${diff} min${diff !== 1 ? \"s\" : \"\"} ago)`\r\n            setTimeDifference(diffString);\r\n        }\r\n    }, [])\r\n\r\n    return (\r\n        <Popup\r\n            latitude={marker.latitude}\r\n            longitude={marker.longitude}\r\n            onClose={closeTooltip}\r\n            closeButton={false}\r\n            closeOnClick={false}\r\n            offsetLeft={17.5}\r\n        >\r\n            <div style={{ margin: 10, color: \"#2C292D\", display: \"flex\", flexDirection: \"column\", justifyContent: \"center\" }}>\r\n                <div style={{ fontSize: 20, fontWeight: \"bold\", fontFamily: \"AdobeClean\", width: 150, margin: \"0 auto\" }}>\r\n                    {marker.name}\r\n                </div>\r\n\r\n                <div style={{ fontSize: 12, fontWeight: \"bold\", color: \"#939293\", marginTop: 10, fontFamily: \"AdobeClean\" }}>\r\n                    LAST KNOWN VACANCY\r\n                </div>\r\n\r\n                <div style={{ color: getColorAt(Math.floor(detail.vacancy / 50 * 10)), fontSize: 60, fontWeight: \"bold\", lineHeight: \"60px\", marginBottom: 10, fontFamily: \"AdobeClean\" }}>\r\n                    {detail.vacancy !== -1 ? detail.vacancy : \"-\"}\r\n                </div>\r\n\r\n                <div style={{ fontSize: 12, color: \"#939293\", fontFamily: \"AdobeClean\" }}>\r\n                    Last Update: {`${detail.lastupdate} ${timeDifference ?? \"\"}`}\r\n                </div>\r\n            </div>\r\n        </Popup>\r\n    )\r\n};\r\n\r\nexport default MapBoxMap;"],"sourceRoot":""}